<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VISA æ¹Šåƒå°å¹«æ‰‹ v3</title>
    <script src="https://unpkg.com/tesseract.js@4.0.1/dist/tesseract.min.js"></script>
    <style>
        :root { --visa-blue: #0033a0; --success: #28a745; --danger: #dc3545; --warning: #ffc107; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; color: #333; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h2 { color: var(--visa-blue); margin: 0; font-size: 1.3em; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 12px; }
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-add { background: var(--visa-blue); color: white; width: 100%; }
        .btn-calc { background: var(--success); color: white; width: 100%; font-size: 1.1em; margin-top: 10px; }
        
        /* æ¸…å–®åˆ—è¡¨ */
        ul { list-style: none; padding: 0; margin: 0; }
        li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .btn-del { color: #999; background: none; font-size: 1.2em; padding: 0 5px; transition: 0.2s; }
        .btn-del:hover { color: var(--danger); }

        /* åˆ†çµ„çµæœ */
        .result-group { border-left: 6px solid var(--visa-blue); padding: 15px; margin-top: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-ok { border-color: var(--success); }
        .status-fail { border-color: var(--warning); background: #fffdf5; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 15px; font-size: 0.75em; font-weight: bold; margin-bottom: 8px; }
        .badge-ok { background: var(--success); color: white; }
        .badge-fail { background: var(--warning); color: #856404; }
        .suggestion { font-size: 0.9em; color: var(--danger); font-weight: bold; display: block; margin-top: 8px; }
    </style>
</head>
<body>

    <div class="header-bar">
        <h2>ğŸ’³ VISA æ¹Šåƒç²¾ç®—å¸«</h2>
        <button onclick="clearAll()" style="font-size: 0.8em; color: #666; background: none;">æ¸…é™¤å…¨éƒ¨</button>
    </div>

    <div class="card">
        <div class="input-group">
            <input type="text" id="itemName" placeholder="å“é …åç¨± (å¦‚: è—¥å¦)">
            <input type="number" id="itemPrice" placeholder="é‡‘é¡" inputmode="decimal">
        </div>
        <button class="btn-add" onclick="addItem()">ï¼‹ åŠ å…¥æ¸…å–®</button>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px;">
            <h3 style="margin:0; font-size: 1em;">ç›®å‰æ¸…å–®</h3>
            <div style="text-align: right; font-size: 0.9em; color: #666;">
                ç¸½è¨ˆ: Â¥<span id="totalDisplay">0</span><br>
                â‰ˆ NT$ <span id="totalTWD">0</span>
            </div>
        </div>
        <ul id="itemList"></ul>
        <button class="btn-calc" onclick="calculateGroups()">âš™ï¸ åŸ·è¡Œç²¾æº–åˆ†çµ„</button>
    </div>

    <div id="results"></div>

    <script>
        let items = [];
        const TARGET = 1000;
        const JPY_TWD_RATE = 0.215;

        function addItem() {
            const nameEl = document.getElementById('itemName');
            const priceEl = document.getElementById('itemPrice');
            const price = parseFloat(priceEl.value);
            if (!price) return;

            items.push({ id: Date.now(), name: nameEl.value || 'é …ç›®', price });
            nameEl.value = '';
            priceEl.value = '';
            renderList();
        }

        function deleteItem(id) {
            items = items.filter(i => i.id !== id);
            renderList();
        }

        function clearAll() {
            if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å“é …å—ï¼Ÿ")) {
                items = [];
                renderList();
                document.getElementById('results').innerHTML = '';
            }
        }

        function renderList() {
            const listEl = document.getElementById('itemList');
            let total = 0;
            listEl.innerHTML = items.map(item => {
                total += item.price;
                return `<li>
                    <div style="flex:1"><strong>${item.name}</strong></div>
                    <div style="margin-right:15px">Â¥${item.price.toLocaleString()}</div>
                    <button class="btn-del" onclick="deleteItem(${item.id})">ğŸ—‘ï¸</button>
                </li>`;
            }).join('');
            document.getElementById('totalDisplay').innerText = total.toLocaleString();
            document.getElementById('totalTWD').innerText = Math.round(total * JPY_TWD_RATE).toLocaleString();
        }

        // --- æ ¸å¿ƒæ¼”ç®—æ³•ï¼šä¿®æ­£åˆ†çµ„é‚è¼¯ ---
        function calculateGroups() {
            if (items.length === 0) return;
            
            // å…ˆä¾åƒ¹æ ¼å¾å¤§åˆ°å°æ’åºï¼Œåˆ©æ–¼è£ç®±
            let pool = [...items].sort((a, b) => b.price - a.price);
            let groups = [];

            while (pool.length > 0) {
                let currentGroup = [];
                let currentSum = 0;

                // æ¯å€‹çµ„åˆè‡³å°‘æ‹¿ä¸€å€‹ç•¶å‰æœ€å¤§çš„
                currentGroup.push(pool[0]);
                currentSum += pool[0].price;
                pool.splice(0, 1);

                // å˜—è©¦å¾å‰©ä¸‹çš„æ± å­è£¡æ‰¾å‡ºèƒ½å¡«é€²é€™çµ„ã€ä¸”æœ€æ¥è¿‘ 1000 çš„çµ„åˆ
                // é€™è£¡æ¡ç”¨ Greedy é‚è¼¯ï¼šåªè¦åŠ äº†ä¸æœƒå¤§å¹…è¶…é 1000 å¤ªå¤šï¼Œæˆ–è€…é‚„æ²’æ»¿ 1000ï¼Œå°±ç¹¼çºŒåŠ 
                for (let i = 0; i < pool.length; i++) {
                    if (currentSum < TARGET) {
                        currentSum += pool[i].price;
                        currentGroup.push(pool[i]);
                        pool.splice(i, 1);
                        i--; // å› ç‚ºç§»é™¤äº†å…ƒç´ ï¼Œç´¢å¼•è¦å›é€€
                    }
                }
                groups.push({ items: currentGroup, sum: currentSum });
            }
            renderResultUI(groups);
        }

        function renderResultUI(groups) {
            const resDiv = document.getElementById('results');
            resDiv.innerHTML = '<h3 style="margin-left:5px">åˆ†çµ„å»ºè­°çµæœ</h3>';

            groups.forEach((g, idx) => {
                const ok = g.sum >= TARGET;
                const div = document.createElement('div');
                div.className = `result-group ${ok ? 'status-ok' : 'status-fail'}`;
                
                let html = `
                    <span class="badge ${ok ? 'badge-ok' : 'badge-fail'}">${ok ? 'âœ… é”æ¨™ (å¯æŠ½ç)' : 'âš ï¸ æœªé”æ¨™'}</span>
                    <strong style="display:block; font-size: 1.1em;">çµ„åˆ ${idx + 1}: Â¥${g.sum.toLocaleString()}</strong>
                    <div style="font-size: 0.8em; color: #888;">â‰ˆ NT$ ${Math.round(g.sum * JPY_TWD_RATE)}</div>
                    <div style="margin-top:8px; font-size: 0.85em; color: #666; border-top: 1px dashed #eee; padding-top:8px;">
                        ${g.items.map(i => i.name + ' (Â¥' + i.price + ')').join(' + ')}
                    </div>
                `;

                if (!ok) {
                    html += `<span class="suggestion">ğŸ’¡ å†æ¹Š Â¥${TARGET - g.sum} å³å¯å¤šæŠ½ä¸€æ¬¡ï¼</span>`;
                }
                div.innerHTML = html;
                resDiv.appendChild(div);
            });
            // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨çœ‹çµæœ
            resDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
